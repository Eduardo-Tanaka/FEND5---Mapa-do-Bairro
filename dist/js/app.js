function getWeather(e){e.temp=ko.observable(),e.myLocation=ko.observable(),$.ajax({url:"https://api.openweathermap.org/data/2.5/weather?lat="+latitude+"&lon="+longitude+"&lang=pt&units=metric&APPID=88234a69ee98b9fb7a6c6493aef2ce79",type:"GET"}).done(function(o){e.myLocation(o.name+" - "+o.weather[0].description),e.temp(o.main.temp+"ºC")})}function initMap(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){latitude=e.coords.latitude,longitude=e.coords.longitude,map=new google.maps.Map(document.getElementById("map"),{center:{lat:latitude,lng:longitude},zoom:15}),marker=new google.maps.Marker({map:map,position:{lat:latitude,lng:longitude},animation:google.maps.Animation.BOUNCE}),google.maps.event.addListener(marker,"click",function(){infowindow.setContent("Minha Localização"),infowindow.open(map,this)}),ko.applyBindings(new MyViewModel)},function(e){alert("Erro ao obter localização!"),console.log("Erro ao obter localização.",e)}):alert("Navegador não suporta Geolocalização!")}function createMarker(e,o){$.ajax({url:"https://api.foursquare.com/v2/venues/search?client_id=DIMPKPOCLGUA50Y2SXLYH1L4BXWVWAAV15VLKO2VIDGL3YGV&client_secret=3HUKKNO1CR3P0AJD4MC1CAUXCO02POPGU0TTLS4H3YSG23DR&v=20130815&ll="+e.geometry.location.lat()+","+e.geometry.location.lng()+"&query="+e.name+"&limit=1",type:"GET"}).done(function(a){var n=new google.maps.Marker({map:map,position:e.geometry.location}),t=a.response.venues[0].url,i=e.name+"<br>Telefone: "+a.response.venues[0].contact.formattedPhone+"<br>Endereço: "+a.response.venues[0].location.formattedAddress[0]+"<br>site: <a href="+t+">"+t+"</a>";google.maps.event.addListener(n,"click",function(){infowindow.setContent(i),infowindow.open(map,this),map.setCenter(n.getPosition()),n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},1500)}),markers.push(n),o.locations.push({location:e.name,position:e.geometry.location,placeName:e.name,marker:n,content:i})}).fail(function(e,o,a){alert("ERRO: "+a)}).always(function(){clickLink()})}function setMapOnAll(e,o){for(var a=0;a<o.length;a++)o[a].setMap(e)}function clearMarkers(){setMapOnAll(null,markers)}function MyViewModel(){var e=this;getWeather(e),e.locations=ko.observableArray([]);var o={location:{lat:latitude,lng:longitude},radius:"2000",types:["restaurant"]};infowindow=new google.maps.InfoWindow,(service=new google.maps.places.PlacesService(map)).nearbySearch(o,function(o,a){if(a==google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<o.length;n++)createMarker(o[n],e)}),e.paramFilter=ko.observable(),e.filteredLocations=ko.computed(function(){if(e.paramFilter()){clearMarkers();for(var o=ko.utils.arrayFilter(e.locations(),function(o){return new RegExp(e.paramFilter(),"ig").test(o.location)}),a=[],n=0;n<o.length;n++)a.push(o[n].marker);return setMapOnAll(map,a),o}return setMapOnAll(map,markers),e.locations()}),e.filtrar=function(){e.paramFilter()},e.jumpMap=function(o){map.panTo(e.filteredLocations()[o].position),e.filteredLocations()[o].marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.filteredLocations()[o].marker.setAnimation(null)},1500),infowindow.setContent(e.filteredLocations()[o].content),infowindow.open(map,e.filteredLocations()[o].marker)}}function toggleNav(){$("#main").hasClass("open-sidebar")?($("#mySidenav").css("width","0"),$("#main").css("marginLeft","0"),$("#main").removeClass("open-sidebar"),$("#main").addClass("close-sidebar")):($("#mySidenav").css("width","250px"),$("#main").css("marginLeft","250px"),$("#main").removeClass("close-sidebar"),$("#main").addClass("open-sidebar"))}function toggleLink(e){$(".link-map").each(function(e,o){$(this).removeClass("active")}),e.addClass("active")}function clickLink(){$(".link-map").on("click",function(e){e.preventDefault(),toggleLink($(this))})}var map,marker,infowindow,service,latitude,longitude,markers=[];
